{% extends "base.html" %}

{% block title %}Analysis for {{ ticker }}{% endblock %}

{% block content %}
<div class="container">
  <header class="result-header">
    <h1>Analysis for {{ ticker }}</h1>
    <div class="actions">
      <a class="btn secondary" href="{{ url_for('web.index') }}">New Analysis</a>
      <form action="{{ url_for('web.reset_cache') }}" method="post" class="inline-form" data-loading-target="loading">
        <input type="hidden" name="ticker" value="{{ ticker }}">
        <button type="submit" class="btn">Reset Cache</button>
      </form>
    </div>
  </header>

  <!-- Include Tab Navigation -->
  {% include "partials/_tabs.html" %}

  <!-- Include Tab Contents -->
  {% include "partials/_metrics.html" %}
  {% include "partials/_dcf.html" %}
  {% include "partials/_transcripts.html" %}
</div>

<!-- Modal for Chart Popup -->
<div id="chartModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h3 id="chartTitle" class="chart-title"></h3>
    <canvas id="metricChart"></canvas>
    <div id="trendBadges" class="trend-badges"></div>
  </div>
</div>

<script id="historical-metrics-data" type="application/json">{{ metrics.historical_metrics | default([], true) | tojson }}</script>
<script id="metric-trends-data" type="application/json">{{ metrics.trend_windows | default({}, true) | tojson }}</script>
<script id="dcf-results-data" type="application/json">{{ dcf_results | default({}, true) | tojson }}</script>
<script id="transcripts-data" type="application/json">{{ transcript_data | default([], true) | tojson }}</script>
{% endblock %}
